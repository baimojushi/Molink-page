<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0">
  <title>Mo:link Design · 查看交付结果</title>
  <style>
    :root {
      --color-primary: #6b4c3b;
      --color-primary-light: #8b6f5e;
      --color-primary-dark: #4a3228;
      --color-accent: #7a9e7e;
      --color-text-primary: #2a2a2a;
      --color-text-secondary: #5a5a5a;
      --color-text-tertiary: #8a8a8a;
      
      /* 玻璃态效果 */
      --glass-bg: rgba(255, 255, 255, 0.15);
      --glass-border: rgba(255, 255, 255, 0.3);
      --glass-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
      --glass-blur: 12px;
      
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      
      --duration-fast: 0.2s;
      --duration-normal: 0.3s;
      --easing-smooth: cubic-bezier(0.4, 0, 0.2, 1);
      --easing-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    /* ==========================================
       移动端全局优化
       ========================================== */
    html {
      touch-action: manipulation;
      -webkit-user-select: none;
      user-select: none;
      scroll-behavior: smooth;
    }

    /* 禁用移动端点击蓝色高亮 */
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      color: var(--color-text-primary);
      -webkit-font-smoothing: antialiased;
    }

    /* ==========================================
       视差背景层 - 支持本地图片替换，跟随滚动但速度减半
       ========================================== */
    .parallax-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      min-height: 100vh; /* 最小高度为视口高度 */
      z-index: 0;
      opacity: 0.4;
      will-change: transform;
      
      /* 默认渐变背景 */
      background: linear-gradient(135deg, #f5efe9 0%, #e8dfd5 100%);
      
      /* 移动端图片背景（优先加载小尺寸） */
      background-image: url('/images/background-mobile.jpg');
      background-size: cover;
      background-position: center top;
      background-repeat: no-repeat;
      background-attachment: scroll;
    }

    /* PC端使用高清图片 */
    @media (min-width: 768px) {
      .parallax-bg {
        background-image: url('/images/background.jpg');
      }
    }

    /* 格网背景已移除，使用纯图片背景 */

    .parallax-bg::after {
      content: '';
      position: absolute;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='3.5' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
      opacity: 0.6;
      mix-blend-mode: overlay;
    }

    /* ==========================================
       页面头部 - 玻璃态
       ========================================== */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      backdrop-filter: blur(var(--glass-blur)) saturate(180%);
      background: var(--glass-bg);
      border-bottom: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      background-image: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.3) 0%,
        rgba(255, 255, 255, 0.05) 50%,
        rgba(255, 255, 255, 0.1) 100%
      );
    }
    
    .back-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      border-radius: 8px;
      transition: all var(--duration-normal) var(--easing-bounce);
      text-decoration: none;
      color: var(--color-primary-dark);
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(4px);
    }

    /* 移动端增大可点击区域 */
    @media (max-width: 767px) {
      .back-btn {
        width: 44px;
        height: 44px;
        font-size: 24px;
      }
    }

    /* PC端悬停效果（触摸设备禁用） */
    @media (hover: hover) {
      .back-btn:hover { 
        background: rgba(255, 255, 255, 0.5);
        transform: translateX(-3px) scale(1.05);
      }
    }

    .back-btn:active { transform: translateX(-1px) scale(0.98); }

    /* 移动端点击反馈 */
    @media (max-width: 767px) {
      .back-btn:active {
        transform: scale(0.95);
        background: rgba(255, 255, 255, 0.5);
      }
    }
    
    .header-title { 
      font-size: 16px; 
      font-weight: 600;
      color: var(--color-primary-dark);
    }

    /* ==========================================
       主容器 - 视差前景层
       ========================================== */
    .container {
      position: relative;
      z-index: 1;
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 16px 60px;
    }

    /* 移动端增加间距 */
    @media (max-width: 767px) {
      .container {
        padding: 24px 20px 80px;
      }
    }

    /* ==========================================
       状态卡片 - Glassmorphism
       ========================================== */
    .status-card {
      backdrop-filter: blur(var(--glass-blur)) saturate(180%);
      background: var(--glass-bg);
      border-radius: var(--radius-xl);
      padding: 32px 24px;
      text-align: center;
      border: 1px solid var(--glass-border);
      margin-bottom: 20px;
      box-shadow: var(--glass-shadow);
      position: relative;
      
      background-image: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.3) 0%,
        rgba(255, 255, 255, 0.05) 50%,
        rgba(255, 255, 255, 0.1) 100%
      );
      
      animation: slideUp 0.5s var(--easing-smooth);
    }

    /* 移动端增加padding和加宽边缘 */
    @media (max-width: 767px) {
      .status-card {
        padding: 36px 28px;
        margin-bottom: 24px;
        border-width: 1.5px;
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 白色噪点纹理 */
    .status-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: var(--radius-xl);
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.5' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.05'/%3E%3C/svg%3E");
      pointer-events: none;
      mix-blend-mode: overlay;
    }
    
    .status-card .icon { 
      font-size: 40px; 
      margin-bottom: 12px;
      display: inline-block;
      animation: iconBounce 0.6s var(--easing-bounce);
    }

    /* 移动端增大图标 */
    @media (max-width: 767px) {
      .status-card .icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
    }

    @keyframes iconBounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    .status-card h2 { 
      font-size: 18px; 
      margin-bottom: 8px;
      color: var(--color-text-primary);
    }

    @media (max-width: 767px) {
      .status-card h2 {
        font-size: 20px;
        margin-bottom: 10px;
      }
    }

    .status-card p { 
      font-size: 14px; 
      color: var(--color-text-secondary); 
      line-height: 1.5; 
    }

    @media (max-width: 767px) {
      .status-card p {
        font-size: 15px;
        line-height: 1.6;
      }
    }

    /* ==========================================
       图片列表
       ========================================== */
    .image-list { 
      display: flex; 
      flex-direction: column; 
      gap: 16px; 
    }

    /* 移动端增加间距 */
    @media (max-width: 767px) {
      .image-list {
        gap: 20px;
      }
    }
    
    .image-item {
      backdrop-filter: blur(var(--glass-blur)) saturate(180%);
      background: var(--glass-bg);
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      transition: all var(--duration-normal) var(--easing-smooth);
      position: relative;
      
      background-image: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.25) 0%,
        rgba(255, 255, 255, 0.05) 100%
      );
      
      animation: slideUp 0.5s var(--easing-smooth);
      animation-fill-mode: both;
    }

    /* 移动端加宽边缘 */
    @media (max-width: 767px) {
      .image-item {
        border-width: 1.5px;
      }
    }

    .image-item:nth-child(1) { animation-delay: 0.1s; }
    .image-item:nth-child(2) { animation-delay: 0.2s; }
    .image-item:nth-child(3) { animation-delay: 0.3s; }
    .image-item:nth-child(4) { animation-delay: 0.4s; }

    /* PC端悬停放大（触摸设备禁用） */
    @media (hover: hover) {
      .image-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(31, 38, 135, 0.25);
      }
      
      .image-item:hover img {
        transform: scale(1.02);
      }
    }
    
    .image-item img {
      width: 100%;
      display: block;
      -webkit-touch-callout: default;
      transition: transform var(--duration-normal) var(--easing-smooth);
    }
    
    .image-item .hint {
      padding: 8px 12px;
      font-size: 11px;
      color: var(--color-text-tertiary);
      text-align: center;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(4px);
    }

    /* 移动端增大提示文字 */
    @media (max-width: 767px) {
      .image-item .hint {
        padding: 10px 14px;
        font-size: 12px;
      }
    }

    /* ==========================================
       等待状态动画
       ========================================== */
    .waiting-dots span {
      animation: blink 1.4s infinite both;
    }
    .waiting-dots span:nth-child(2) { animation-delay: 0.2s; }
    .waiting-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink {
      0%, 80%, 100% { opacity: 0.3; }
      40% { opacity: 1; }
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--color-text-tertiary);
    }
  </style>
</head>
<body>

  <!-- 视差背景层 -->
  <div class="parallax-bg"></div>

  <div class="header">
    <a class="back-btn" href="/" title="返回首页">‹</a>
    <div class="header-title" id="page-title">加载中...</div>
  </div>

  <div class="container" id="content">
    <div class="loading">加载中...</div>
  </div>

  <script>
    /* ==========================================
       视差滚动效果 - 背景速度为内容的50%
       移动端优化：避免地址栏隐藏导致的背景抖动
       ========================================== */
    const parallaxBg = document.querySelector('.parallax-bg');
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    
    // 移动端使用固定高度，避免地址栏隐藏/显示导致的抖动
    if (isMobile) {
      const viewportHeight = window.innerHeight;
      parallaxBg.style.height = `${viewportHeight * 2}px`;
    } else {
      // PC端：动态计算背景高度
      function 更新背景高度() {
        const docHeight = document.documentElement.scrollHeight;
        parallaxBg.style.height = `${docHeight * 1.5}px`;
      }
      
      更新背景高度();
      
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(更新背景高度, 150);
      });
    }
    
    // 视差滚动：背景移动速度为滚动的50%
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const scrollY = window.scrollY;
          parallaxBg.style.transform = `translateY(${scrollY * 0.5}px)`;
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });

    const token = window.location.pathname.split('/d/')[1];

    async function 加载交付数据() {
      try {
        const resp = await fetch(`/d/${token}/data`);
        const data = await resp.json();

        if (resp.status === 404) {
          渲染错误('页面不存在');
          return;
        }

        if (data.status === 'pending') {
          渲染等待中(data);
        } else if (data.status === 'delivered') {
          渲染交付结果(data);
        }
      } catch (err) {
        渲染错误('网络异常，请稍后刷新重试');
      }
    }

    function 渲染等待中(data) {
      document.getElementById('page-title').textContent = data.service_type_label;
      document.getElementById('content').innerHTML = `
        <div class="status-card">
          <div class="icon">○</div>
          <h2>正在处理中</h2>
          <p>您的「${data.service_type_label}」服务正在处理中<br>
          <span class="waiting-dots"><span>.</span><span>.</span><span>.</span></span><br>
          完成后将通知您，请耐心等待。</p>
        </div>
      `;
    }

    function 渲染交付结果(data) {
      document.getElementById('page-title').textContent = data.service_type_label;

      let imagesHtml = '';
      if (data.images && data.images.length > 0) {
        imagesHtml = `<div class="image-list">
          ${data.images.map(img => `
            <div class="image-item">
              <img src="/deliveries/${img}" alt="交付图片">
              <div class="hint">长按图片可保存到相册</div>
            </div>
          `).join('')}
        </div>`;
      }

      document.getElementById('content').innerHTML = `
        <div class="status-card">
          <div class="icon">✓</div>
          <h2>已完成</h2>
          <p>您的「${data.service_type_label}」服务已处理完毕<br>交付时间：${data.delivered_at}</p>
        </div>
        ${imagesHtml}
      `;
    }

    function 渲染错误(msg) {
      document.getElementById('page-title').textContent = '出错了';
      document.getElementById('content').innerHTML = `
        <div class="status-card">
          <div class="icon">×</div>
          <h2>无法加载</h2>
          <p>${msg}</p>
        </div>
      `;
    }

    加载交付数据();
  </script>
</body>
</html>
